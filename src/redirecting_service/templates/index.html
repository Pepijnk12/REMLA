<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stackoverflow Tag Predictor</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
</head>

<body>
<div class="container pt-3">

  <div class="d-flex">
    <div class="p-2 flex-shrink-1">
      <img src="./assets/undraw_online_test_re_kyfx.svg" alt="heading" width="130"/>
    </div>
    <div class="p-2  w-100">
      <h5 class="text-center"> <b>CS4295</b> Release Engineering for Machine Learning Applications (REMLA 2021 - 2022) </h5>
      <h1 class="text-center"> Stack overflow tag predictor</h1>
      <ul class="list-inline text-center">      
        <li class="list-inline-item">Keon Chen 5511526 | </li>
        <li class="list-inline-item">Budi Han 4389336 | </li>
        <li class="list-inline-item">Pascal Hildebrand 4353765 | </li>
        <li class="list-inline-item">Quinten van Eijs 4513681 | </li>
        <li class="list-inline-item">Pepijn Klop 4684311</li>
      </ul>
    </div>
  </div>
  <div class="input-group mb-3">
    <input type="text" class="form-control" placeholder="Stackoverflow title" id="post-input">
    <div class="input-group-append">
      <button class="btn btn-outline-secondary" type="button"
              onclick="predict(document.getElementById('post-input').value )">
              <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-list-search" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <circle cx="15" cy="15" r="4" />
                <path d="M18.5 18.5l2.5 2.5" />
                <path d="M4 6h16" />
                <path d="M4 12h4" />
                <path d="M4 18h4" />
              </svg>
              Predict
      </button>
    </div>
  </div>
  <div id="loading" class="spinner-border" role="status">
    <span class="sr-only">Loading...</span>
  </div>
  <div id="result">
    <p>Suggested tags: <span id="result-tags"></span></p>
    <div class="mt-4">
        <h6>Please add tags to your post (comma-seperated)</h6>
        <div class="input-group mb-3">
          <input type="text" class="form-control" placeholder="Tags" id="feedback-input">
          <div class="input-group-append">
            <button class="btn btn-outline-secondary" type="button"
                    onclick="sendFeedback(document.getElementById('feedback-input').value)">Post
            </button>
          </div>
        </div>
          <div id="thanks-feedback">
            <h4>Thank you for your post!</h4>
          </div>
    </div>

  </div>
</div>
<script>
    document.getElementById('loading').style.display = "none";
    document.getElementById('result').style.display = "none";
    document.getElementById('thanks-feedback').style.display = "none";

    let results;
    function predict(title,version) {
        document.getElementById('loading').style.display = "block";
        document.getElementById('result').style.display = "none";

        fetch("http://localhost:30001/predict", {
            method: "POST",
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({post: title,version: version})
        })
            .then(res => res.json())
            .then(responseData => {
                results = responseData;
                document.getElementById('result-tags').innerHTML = responseData['result'].join(', ');
                document.getElementById('result').style.display = "block";
                document.getElementById('loading').style.display = "none";
            });
    }

    function sendFeedback(feedback) {
        console.log(results);
        fetch("http://localhost:30001/submit-feedback", {
            method: "POST",
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                feedback: feedback,
                results: results
            })
        })
            .then(res => res.json())
            .then(_ => {
                document.getElementById('thanks-feedback').style.display = "block";
            });
    }
    function getActiveModel() {
        fetch("http://localhost:30001/active-model", {
            method: "GET",
            headers: {'Content-Type': 'application/json'},
        })
            .then(res => res.json())
    }
    getActiveModel()
</script>
</body>
</html>
