<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stackoverflow Tag Predictor</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
</head>

<body>
<div class="container pt-3">
  <div class="input-group mb-3">
    <input type="text" class="form-control" placeholder="Stackoverflow title" id="post-input">
    <div class="input-group-append">
      <button class="btn btn-outline-secondary" type="button"
              onclick="predict(document.getElementById('post-input').value)">Predict
      </button>
    </div>
  </div>
  <div id="loading" class="spinner-border" role="status">
    <span class="sr-only">Loading...</span>
  </div>
  <div id="result">
    <p>Suggested tags: <span id="result-tags"></span></p>
    <div class="mt-4">
        <h6>Please add tags to your post (comma-seperated)</h6>
        <div class="input-group mb-3">
          <input type="text" class="form-control" placeholder="Tags" id="feedback-input">
          <div class="input-group-append">
            <button class="btn btn-outline-secondary" type="button"
                    onclick="sendFeedback(document.getElementById('feedback-input').value)">Post
            </button>
          </div>
        </div>
          <div id="thanks-feedback">
            <h4>Thank you for your post!</h4>
          </div>
    </div>

  </div>
</div>
<script>
    document.getElementById('loading').style.display = "none";
    document.getElementById('result').style.display = "none";
    document.getElementById('thanks-feedback').style.display = "none";

    let results;
    function predict(title) {
        document.getElementById('loading').style.display = "block";
        document.getElementById('result').style.display = "none";

        fetch("http://0.0.0.0:8080/predict", {
            method: "POST",
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({post: title})
        })
            .then(res => res.json())
            .then(responseData => {
                results = responseData;
                let activeModel = responseData['active_model']
                document.getElementById('result-tags').innerHTML = responseData[activeModel].join(', ');
                document.getElementById('result').style.display = "block";
                document.getElementById('loading').style.display = "none";
            });
    }

    function sendFeedback(feedback) {
        console.log(results);
        fetch("http://0.0.0.0:8080/submit-feedback", {
            method: "POST",
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                feedback: feedback,
                results: results
            })
        })
            .then(res => res.json())
            .then(_ => {
                document.getElementById('thanks-feedback').style.display = "block";
            });
    }
</script>
</body>
</html>
